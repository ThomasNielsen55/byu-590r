name: Deploy Complete

on:
  workflow_call:
    inputs:
      ec2_host:
        required: true
        type: string
      branch_name:
        required: true
        type: string

jobs:
  deploy-complete:
    name: Deploy Complete
    runs-on: ubuntu-latest

    steps:
      - name: Comment deployment success
        uses: actions/github-script@v7
        with:
          script: |
            const ec2Host = '${{ inputs.ec2_host }}';
            const branchName = '${{ inputs.branch_name }}';

            // Only comment on pull requests, not on direct pushes
            if (context.payload.pull_request) {
              github.rest.issues.createComment({
                issue_number: context.issue.number,
                owner: context.repo.owner,
                repo: context.repo.repo,
                body: `ðŸš€ **EC2 Deployment Successful!**\n\n**Branch**: ${branchName}\n\nâœ… **Frontend**: Deployed to EC2 (Apache)\nðŸ”— **Frontend URL**: http://${ec2Host}\n\nâœ… **Backend**: Deployed to EC2 (Apache)\nðŸ”— **Backend API**: http://${ec2Host}:4444/api/hello\n\nðŸŽ‰ Your BYU 590R Monorepo is now running on EC2 with Apache!`
              });
            } else {
              // For direct pushes, create a deployment status
              console.log('ðŸš€ EC2 Deployment Successful!');
              console.log(`**Branch**: ${branchName}`);
              console.log('âœ… Frontend: Deployed to EC2 (Apache)');
              console.log(`ðŸ”— Frontend URL: http://${ec2Host}`);
              console.log('âœ… Backend: Deployed to EC2 (Apache)');
              console.log(`ðŸ”— Backend API: http://${ec2Host}:4444/api/hello`);
              console.log('ðŸŽ‰ Your BYU 590R Monorepo is now running on EC2 with Apache!');
            }

